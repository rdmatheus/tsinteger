---
title: "Innovation processes"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Innovation processes}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  fig.align = "center",
  message = FALSE,
  warning = FALSE
)
```

```{r setup}
library(tsinteger)
```

## 1 BerPoi distribution

The BerPoi distribution is a discrete probability distribution that can be used to analyze under-dispersed count data. It provides an easy and straightforward interpretation of its parameters in terms of the theoretical properties of the distribution. In fact, the BerPoi distribution is indexed using the mean and dispersion index (variance-to-mean ratio) parameters. In addition, it has a mathematical simplicity, in the sense that its moments can be obtained in a closed form and the probability and distribution functions of the BerPoi distribution have a simple form and not involve normalizing constants that need to be approximated.

Let $X_1$ and $X_2$ be two independent random variables following a Bernoulli distribution with probability of success $\sqrt{\mu(1 - \phi)}$ and a Poisson distribution with mean $\mu - \sqrt{\mu(1 - \phi)}$, respectively, that is, $X_1 \sim \mbox{Bernoulli}(\sqrt{\mu(1 - \phi)})$ and $X_2 \sim \mbox{Poisson}(\mu - \sqrt{\mu(1 - \phi)})$, where $\mu > 0$ and $0 < \phi < 1$. Then, the Bernoulli-Poisson convolution $X = X_1 + X_2$ has a BerPoi distribution with probability mass function given by
$$\mbox{P}(X = x) = \left(1 - \sqrt{\mu(1 - \phi)} + y\dfrac{\sqrt{\mu(1 - \phi)}}{\mu - \sqrt{\mu(1 - \phi)}}\right)\dfrac{\left[\mu - \sqrt{\mu(1 - \phi)}\right]^y}{y!}\mbox{e}^{-\mu + \sqrt{\mu(1 - \phi)}}, \quad y = 0, 1, \ldots$$

Under this parameterization, it follows that
$$\mbox{E}(X) = \mu \quad \mbox{ and } \quad \mbox{Var}(X) = \mu \phi.$$

The figures below show the probability mass function of the BerPoi distribution for some combinations of the parameter values.

```{r, echo=FALSE, fig.align='default', fig.show='hold'}

xvals <- 0:15
x <- innovation("BP")

## Varying mu
graphics::plot(xvals, x$d(xvals, 0.5, 0.9), type = "n",
               ylab = "Probability mass function", xlab = "x")
mu <- seq(0.5, 5, length.out = 30)
col <- RColorBrewer::brewer.pal(n = 5, name = "Spectral")[5:1]
col <- grDevices::colorRampPalette(colors = col)(length(mu))
for (a in seq_along(mu)) {
  graphics::lines(xvals, x$d(xvals, mu[a], 0.9),
                  col = col[a], type = "b", pch = 16)
}

## Varying phi
graphics::plot(xvals, x$d(xvals, 1, 0.1), type = "n",
               ylab = "Probability mass function", xlab = "x")
phi <- seq(0.1, 0.9, length.out = 30)
col <- RColorBrewer::brewer.pal(n = 5, name = "Spectral")[5:1]
col <- grDevices::colorRampPalette(colors = col)(length(phi))
for (a in seq_along(phi)) {
  graphics::lines(xvals, x$d(xvals, 1, phi[a]), col = col[a],
                  type = "b", pch = 16)
}
```

The parameters $\mu$ and $\phi$ comply with restrictions $\mu > 0$ and $\phi > 1 - \mbox{min}\{\mu, 1/\mu\}$ to ensure that its probability mass function be a legitimate model of probability. The range covered by the possible combinations of the values of the mean $\mu$ and the dispersion index $\phi$ can be seen in the next figure.

```{r, echo=FALSE}
## Constraints
    f <- function(mu){
      p1 <- mu
      p2 <- 1/mu

      out <- vector()
      out[p1 <= p2] <- 1 - p1[p1 <= p2]
      out[p2 <= p1] <- 1 - p2[p2 <= p1]
      out
    }

    graphics::curve(f(x), xlab = "Mean", ylab = "Dispersion index",
          xlim = c(0, 15), col = "white")
    graphics::polygon(x = c(seq(0, 20, 0.001), seq(20, 0, -0.001)),
            y = c(f(seq(0, 20, 0.001)), rep(1, length(seq(0, 20, 0.001)))),
            col = "darkgray", border = F)
    graphics::abline(h = 1, lty = 2)
    graphics::legend("bottomright", legend = "Poisson",
                     lty = 2, bty = "n")
    graphics::box()
```


